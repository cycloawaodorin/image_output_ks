# 連番画像出力
JPEGまたはPNG形式の連番画像出力を行う，AviUtlの出力プラグインです．
本家にある連番BMP出力の変形で，libjpegおよびlibpngを使って圧縮画像を出力します．

## インストール
AviUtlのルートまたはpluginsディレクトリにimage_output_ks.auoをコピーします．

## ビルド
MSYS上でsrcディレクトリに入り，`make`します．ビルドにはlibjpegおよびlibpngが必要です．MSYS2上のgcc以外でのコンパイルは想定されていません．

## 設定項目
### 出力形式
JPEGかPNGかをラジオボタンで選択します．JPEGの場合は，品質を0～100の数値で入力します．拡張子は，この出力形式に関わらず，出力ファイル名で決定されます．

### ファイル名フォーマット/オフセット
連番をファイル名に変換する際の`sprintf`のフォーマット文字列を入力します．連番BMP出力の設定項目とほぼ同じですが，`%s`の位置を変えたり，`%s`をなくしたりできます．

左側の入力欄は，ファイル名フォーマット文字列の入力欄です．`%s`は出力ファイル名の拡張子より前の部分，`%d`等(`%04d`や`%x`などにもできる)は連番を扱います．`%%`とすると文字の「%」を入力でき，`%%`はいくつあっても構いません．`%d`等は必ずちょうど1つでなければなりません．`int`のフォーマットとして正しいものを入力する必要があります．`%s`と`%d`等の順番はどちらでもよく，`%s`はなくても構いません(フォーマット文字列に応じて`sprintf`の呼び出し方を変えています)．

右側の入力欄は，連番のオフセットの入力欄です．(出力範囲の)フレーム番号(0オリジン)+オフセットが`%d`等への入力値となります．

実際の出力ファイル名は，このフォーマット文字列で変換した文字列に，拡張子をつけたものになります．拡張子は出力ファイル名で入力したものがそのまま使われます．例えば，出力ファイル名が「abc.jpg」，フォーマット文字列が`%s_%04d`の場合，出力ファイル名は「abc_0000.jpg」のようになります．

## 制限
JPEG，PNGともに，RGB24bit形式での出力にしか対応していません．

品質の入力値のチェックはしていないので，正しく0以上100以下の十進数整数値を入力してください．

フォーマット文字列の入力値について，`%s`の有無や，`%d`等との前後位置の検査はしますが，正しい入力であるかのチェックはしていません．不正な入力があると，詳細なメッセージなしに出力失敗したり，落ちたりします．

## 参考・謝辞
本プラグインの作成にあたり，下記サイトを参考にしました．感謝します．

- [碧色工房 JPEG画像の入出力](https://www.mm2d.net/main/prog/c/image_io-16.html)
- [碧色工房 PNG画像の入出力](https://www.mm2d.net/main/prog/c/image_io-15.html)
- [万年ビギナーによるビギナーのためのプログラミング講座 第25章 年・月・曜日の書式設定メニューを作る](http://www.geocities.jp/midorinopage/Beginner/beginner25.html#pagetop) (デッドリンク)
